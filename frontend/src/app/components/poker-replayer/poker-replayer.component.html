<div class="riropo-poker-replayer-isolated">
<div class="poker-replayer">
  
  <!-- Header com informa√ß√µes da m√£o -->
  <div class="hand-header" *ngIf="parsedHand">
    <div class="hand-info">
      <h3>{{ parsedHand?.tableName || 'Mesa' }} - M√£o #{{ parsedHand?.id || '0' }}</h3>
      <span class="game-info">{{ parsedHand?.gameType || 'Poker' }} - {{ parsedHand?.stakes || 'N/A' }}</span>
    </div>
    <div class="street-info">
      <span class="current-street">{{ getCurrentStreet().toUpperCase() }}</span>
      <span class="pot-size">Pot: {{ currentPot }}</span>
    </div>
  </div>
  <!-- Mesa de Poker -->
  <div class="poker-table-container">
    <div class="poker-table">
      
      <!-- Feltro da mesa -->
      <div class="table-felt">
        
        <!-- Cartas comunit√°rias -->
        <div class="community-cards">
          <div class="board-label">{{ getCurrentStreet().toUpperCase() }}</div>
          <div class="cards-container">
            <div 
              class="community-card" 
              *ngFor="let card of currentBoard; let i = index"
              [ngClass]="getCardClass(card)"
            >
              {{ formatCard(card) }}
            </div>
            
            <!-- Cartas vazias para completar o board -->
            <div 
              class="community-card empty" 
              *ngFor="let i of [1,2,3,4,5].slice(currentBoard.length)"
            >
              <span class="card-back">üÇ†</span>
            </div>
          </div>
        </div>

        <!-- Pot central -->
        <div class="pot-container">
          <div class="pot-chips">
            <div class="chip-stack">
              <div class="chip chip-1000" *ngFor="let i of Array(Math.floor(currentPot / 1000)).fill(0)"></div>
              <div class="chip chip-500" *ngFor="let i of Array(Math.floor((currentPot % 1000) / 500)).fill(0)"></div>
              <div class="chip chip-100" *ngFor="let i of Array(Math.floor((currentPot % 500) / 100)).fill(0)"></div>
              <div class="chip chip-25" *ngFor="let i of Array(Math.floor((currentPot % 100) / 25)).fill(0)"></div>
            </div>
          </div>
          <div class="pot-amount">{{ currentPot }}</div>
        </div>

        <!-- Jogadores -->
        <div 
          class="player-seat" 
          *ngFor="let player of currentPlayers; let i = index"
          [ngClass]="getPlayerPosition(player)"
          [class.active]="lastAction?.player === player.name"
          [class.hero]="player.isHero"
        >
          
          <!-- Avatar do jogador -->
          <div class="player-avatar">
            <div class="avatar-circle">
              <span class="player-initial">{{ player.name.charAt(0).toUpperCase() }}</span>
            </div>
            
            <!-- Indicadores de posi√ß√£o -->
            <div class="position-indicators">
              <span class="dealer-button" *ngIf="player.isButton">D</span>
              <span class="blind-indicator sb" *ngIf="player.isSmallBlind">SB</span>
              <span class="blind-indicator bb" *ngIf="player.isBigBlind">BB</span>
            </div>
          </div>

          <!-- Informa√ß√µes do jogador -->
          <div class="player-info">
            <div class="player-name" [class.hero-name]="player.isHero">
              {{ player.name }}
              <span class="hero-indicator" *ngIf="player.isHero">üë§</span>
            </div>
            <div class="player-stack">{{ player.stack }}</div>
          </div>

          <!-- Cartas do jogador -->
          <div class="player-cards" *ngIf="player.cards && player.cards.length > 0">
            <div 
              class="card" 
              *ngFor="let card of player.cards"
              [ngClass]="getCardClass(card)"
            >
              {{ formatCard(card) }}
            </div>
          </div>

          <!-- Fichas de aposta -->
          <div class="player-bet" *ngIf="getPlayerBet(player.name) > 0">
            <div class="bet-chips">
              <div class="chip-stack">
                <div class="chip chip-100" *ngFor="let i of Array(Math.floor(getPlayerBet(player.name) / 100)).fill(0)"></div>
                <div class="chip chip-25" *ngFor="let i of Array(Math.floor((getPlayerBet(player.name) % 100) / 25)).fill(0)"></div>
                <div class="chip chip-5" *ngFor="let i of Array(Math.floor((getPlayerBet(player.name) % 25) / 5)).fill(0)"></div>
              </div>
            </div>
            <div class="bet-amount">{{ getPlayerBet(player.name) }}</div>
          </div>

          <!-- A√ß√£o atual -->
          <div class="player-action" *ngIf="lastAction?.player === player.name">
            <div class="action-bubble">
              {{ lastAction ? getActionDescription(lastAction) : 'Nenhuma a√ß√£o' }}
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>

  <!-- Controles de navega√ß√£o -->
  <div class="controls-container">
    
    <!-- Informa√ß√µes da a√ß√£o atual -->
    <div class="current-action-info" *ngIf="getCurrentAction() as action">
      <div class="action-details">
        <strong>{{ action.player }}</strong> {{ getActionDescription(action) }}
        <span class="street-indicator">{{ getCurrentStreet() }}</span>
      </div>
    </div>

    <!-- Bot√µes de controle -->
    <div class="control-buttons">
      <button 
        class="control-btn prev" 
        (click)="previousAction()"
        [disabled]="!canGoPrevious()"
        title="A√ß√£o Anterior"
      >
        ‚èÆÔ∏è Anterior
      </button>
      
      <button 
        class="control-btn play-pause" 
        (click)="isPlaying ? stopAutoPlay() : startAutoPlay()"
        title="Play/Pause"
      >
        {{ isPlaying ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Play' }}
      </button>
      
      <button 
        class="control-btn next" 
        (click)="nextAction()"
        [disabled]="!canGoNext()"
        title="Pr√≥xima A√ß√£o"
      >
        Pr√≥xima ‚ñ∂Ô∏è
      </button>
      
      <button 
        class="control-btn reset" 
        (click)="resetToStart()"
        title="Reiniciar"
      >
        üîÑ Reiniciar
      </button>
    </div>

    <!-- Barra de progresso -->
    <div class="progress-container">
      <div class="progress-bar">
        <div 
          class="progress-fill" 
          [style.width.%]="getProgressPercentage()"
        ></div>
      </div>
      <div class="progress-info">
        Street {{ currentStreetIndex + 1 }}/{{ parsedHand?.streets?.length || 0 }} - 
        A√ß√£o {{ currentActionIndex + 1 }}/{{ parsedHand?.streets?.[currentStreetIndex]?.actions?.length || 0 }}
      </div>
    </div>

    <!-- Controles de velocidade -->
    <div class="speed-controls">
      <label>Velocidade:</label>
      <input 
        type="range" 
        min="0.5" 
        max="3" 
        step="0.5" 
        [(ngModel)]="speed"
        class="speed-slider"
      >
      <span>{{ speed }}x</span>
    </div>

  </div>

</div>

<!-- Estado de loading -->
<div class="loading-state" *ngIf="!parsedHand">
  <div class="loading-spinner"></div>
  <p>Carregando hand history...</p>
</div>

</div>
