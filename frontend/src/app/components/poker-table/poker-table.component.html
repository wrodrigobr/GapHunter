<!-- RIROPO Poker Table - Mesa Interativa -->
<div class="riropo-container">
  <!-- RIROPO Replayer Integration -->
  <div class="riropo-integration">
    <h3>RIROPO Hand Replayer</h3>
    
    <!-- Mostrar input manual apenas se n√£o houver handReplay -->
    <div class="hand-input" *ngIf="!handReplay">
      <textarea 
        [(ngModel)]="handHistoryText" 
        placeholder="Paste your hand history here..."
        rows="5"
        class="hand-textarea">
      </textarea>
      <button (click)="loadHandHistory()" class="load-btn">Load Hand</button>
    </div>
    
    <!-- Mostrar replayer quando houver dados do handReplay -->
    <div *ngIf="handReplay" class="hand-replay-section">
      <button (click)="loadHandFromDatabase()" class="load-btn">Carregar Mesa RIROPO</button>
    </div>
    
    <!-- Mostrar replayer quando houver dados -->
    <app-poker-replayer 
      *ngIf="showReplayer"
      [handHistory]="handHistoryText"
      [backendData]="handReplay"
      [autoPlay]="false"
      [speed]="1"
      (handComplete)="onHandComplete($event)">
    </app-poker-replayer>

    <!-- Bot√£o Tela Cheia -->
    <div class="fullscreen-controls">
      <button 
        class="fullscreen-btn"
        (click)="openFullscreen()"
        title="Abrir em tela cheia"
      >
        <span class="fullscreen-icon">‚õ∂</span>
        Tela Cheia
      </button>
    </div>
  </div>

  <!-- Mesa de Poker -->
  <div class="poker-table">
    <!-- Feltro da Mesa -->
    <div class="table-felt">
      
      <!-- Cartas Comunit√°rias -->
      <div class="community-cards">
        <div class="board-label">{{ currentStreet.toUpperCase() }}</div>
        <div class="cards-container">
          <div 
            class="community-card" 
            *ngFor="let card of currentBoardCards; let i = index"
            [class.new-card]="isNewCard(i)"
          >
            <span class="card-content">{{ formatCards(card) }}</span>
          </div>
          
          <!-- Cartas vazias para completar o board -->
          <div 
            class="community-card empty" 
            *ngFor="let empty of getEmptyCards()"
          >
            <span class="card-back">üÇ†</span>
          </div>
        </div>
      </div>

      <!-- Pot Central -->
      <div class="pot-container">
        <div class="pot-label">POT</div>
        <div class="pot-amount">{{ formatStack(currentPot) }}</div>
      </div>

      <!-- A√ß√£o Atual -->
      <div class="current-action" *ngIf="getCurrentAction() as action">
        <div class="action-player">{{ action.player }}</div>
        <div class="action-description">{{ getActionDescription(action) }}</div>
      </div>

    </div>

    <!-- Jogadores -->
    <div 
      class="player-seat" 
      *ngFor="let player of currentPlayers"
      [style.left.%]="getPlayerPosition(player.position).x"
      [style.top.%]="getPlayerPosition(player.position).y"
      [ngClass]="getPlayerClass(player)"
    >
      
      <!-- Avatar do Jogador -->
      <div class="player-avatar">
        <div class="avatar-circle">
          <span class="player-initial">{{ player.name.charAt(0).toUpperCase() }}</span>
        </div>
        
        <!-- Indicadores -->
        <div class="player-indicators">
          <span class="dealer-button" *ngIf="player.is_button">D</span>
          <span class="blind-indicator sb" *ngIf="player.is_small_blind">SB</span>
          <span class="blind-indicator bb" *ngIf="player.is_big_blind">BB</span>
        </div>
      </div>

      <!-- Informa√ß√µes do Jogador -->
      <div class="player-info">
        <div class="player-name" [class.hero-name]="player.is_hero">
          {{ player.name }}
          <span class="hero-indicator" *ngIf="player.is_hero">üë§</span>
        </div>
        <div class="player-stack">{{ formatStack(player.stack) }}</div>
      </div>

      <!-- Cartas do Jogador -->
      <div class="player-cards-container" *ngIf="shouldShowCards(player)">
        <div [ngClass]="getPlayerCardClass(player)">
          <span class="cards-text">{{ formatCards(player.cards || '') }}</span>
        </div>
      </div>

      <!-- Fichas Visuais -->
      <div class="poker-chips chips-position-{{ player.position }}" *ngIf="shouldShowChips(player)">
        <div class="chip-stack">
          <div 
            *ngFor="let chipType of getPlayerChips(player); let i = index"
            class="chip-group"
          >
            <div 
              *ngFor="let chip of Array(chipType.count).fill(0); let j = index"
              class="chip {{ chipType.class }} chip-animate-in"
              [style.animation-delay.ms]="(i * chipType.count + j) * 100"
            ></div>
          </div>
        </div>
        <div class="bet-amount">
          {{ formatStack(player.current_bet) }}
        </div>
      </div>

      <!-- Status de A√ß√£o -->
      <div class="action-status" *ngIf="player.is_active">
        <div class="action-indicator"></div>
      </div>

    </div>

  </div>

  <!-- Controles de Navega√ß√£o -->
  <div class="table-controls">
    
    <!-- Mensagem quando n√£o h√° dados -->
    <div class="no-data-message" *ngIf="!handReplay && !showReplayer">
      <p>Nenhuma m√£o carregada. Clique em "Ver An√°lise" para carregar uma m√£o do banco de dados.</p>
    </div>

    <!-- Bot√µes de Controle -->
    <div class="control-buttons">
      <button 
        class="control-btn" 
        (click)="previousAction()"
        [disabled]="!canGoPrevious()"
        title="A√ß√£o Anterior"
      >
        ‚èÆÔ∏è Anterior
      </button>
      
      <button 
        class="control-btn" 
        (click)="nextAction()"
        [disabled]="!canGoNext()"
        title="Pr√≥xima A√ß√£o"
      >
        Pr√≥xima ‚ñ∂Ô∏è
      </button>
      
      <button 
        class="control-btn" 
        (click)="previousStreet()"
        [disabled]="!canGoPreviousStreet()"
        title="Street Anterior"
      >
        ‚è™ Street
      </button>
      
      <button 
        class="control-btn" 
        (click)="nextStreet()"
        [disabled]="!canGoNextStreet()"
        title="Pr√≥xima Street"
      >
        Street ‚è©
      </button>
      
      <button 
        class="control-btn reset" 
        (click)="resetToStart()"
        title="Reiniciar"
      >
        üîÑ Reiniciar
      </button>
    </div>

    <!-- Barra de Progresso -->
    <div class="progress-container">
      <div class="progress-bar">
        <div 
          class="progress-fill" 
          [style.width.%]="getProgressPercentage()"
        ></div>
      </div>
      <span class="progress-text">{{ getProgressText() }}</span>
    </div>

  </div>

  <!-- An√°lise da A√ß√£o Atual -->
  <div class="action-analysis" *ngIf="getCurrentAction() as action">
    <h4>An√°lise da A√ß√£o</h4>
    <div class="analysis-content">
      <p><strong>{{ action.player }}</strong> {{ getActionDescription(action) }}</p>
      <div class="analysis-details">
        <span>Posi√ß√£o: {{ getPlayerPositionName(action.player) }}</span>
        <span *ngIf="action.amount > 0">Valor: {{ formatStack(action.amount) }}</span>
        <span>Street: {{ currentStreet }}</span>
      </div>
      
      <!-- An√°lise espec√≠fica se for o her√≥i -->
      <div class="hero-analysis" *ngIf="action.player === handReplay?.hero_name">
        <div class="analysis-badge hero">üéØ A√ß√£o do Her√≥i</div>
        <p>Esta √© uma a√ß√£o sua. Analise se foi a melhor decis√£o considerando:</p>
        <ul>
          <li>For√ßa das suas cartas</li>
          <li>Posi√ß√£o na mesa</li>
          <li>Tamanho do pot</li>
          <li>Padr√µes dos oponentes</li>
        </ul>
      </div>
    </div>
  </div>

</div>

<!-- Estado de Loading -->
<div class="loading-state" *ngIf="!handReplay">
  <div class="loading-spinner"></div>
  <p>Carregando dados da m√£o...</p>
</div>

<!-- Overlay Fullscreen -->
<div class="fullscreen-overlay" *ngIf="isFullscreen" (click)="closeFullscreen()">
  <div class="fullscreen-content" (click)="$event.stopPropagation()">
    
    <!-- Header Fullscreen -->
    <div class="fullscreen-header">
      <div class="fullscreen-title">
        <h2>{{ handReplay?.table_name }} - M√£o #{{ handReplay?.hand_id }}</h2>
        <span class="fullscreen-subtitle">{{ currentStreet.toUpperCase() }} - A√ß√£o {{ currentActionIndex + 1 }}</span>
      </div>
      <button class="close-fullscreen-btn" (click)="closeFullscreen()" title="Fechar tela cheia">
        ‚úï
      </button>
    </div>

    <!-- Mesa em Tela Cheia -->
    <div class="fullscreen-table">
      
      <!-- Feltro da Mesa -->
      <div class="table-felt">
        
        <!-- Cartas Comunit√°rias -->
        <div class="community-cards">
          <div class="board-label">{{ currentStreet.toUpperCase() }}</div>
          <div class="cards-container">
            <div 
              class="community-card" 
              *ngFor="let card of currentBoardCards; let i = index"
              [class.new-card]="isNewCard(i)"
              [ngClass]="getCardClass(card)"
            >
              {{ formatCards(card) }}
            </div>
            
            <!-- Cartas vazias para completar o board -->
            <div 
              class="community-card empty" 
              *ngFor="let empty of getEmptyCards()"
            >
              <span class="card-back">üÇ†</span>
            </div>
          </div>
        </div>

        <!-- Pot Central -->
        <div class="pot-container">
          <div class="pot-label">POT</div>
          <div class="pot-amount">{{ formatStack(currentPot) }}</div>
        </div>

        <!-- A√ß√£o Atual -->
        <div class="current-action" *ngIf="getCurrentAction() as action">
          <div class="action-player">{{ action.player }}</div>
          <div class="action-description">{{ getActionDescription(action) }}</div>
        </div>

      </div>

      <!-- Jogadores -->
      <div 
        class="player-seat" 
        *ngFor="let player of currentPlayers"
        [style.left.%]="getPlayerPosition(player.position).x"
        [style.top.%]="getPlayerPosition(player.position).y"
        [ngClass]="getPlayerClass(player)"
      >
        
        <!-- Avatar do Jogador -->
        <div class="player-avatar">
          <div class="avatar-circle">
            <span class="player-initial">{{ player.name.charAt(0).toUpperCase() }}</span>
          </div>
          
          <!-- Indicadores -->
          <div class="player-indicators">
            <span class="dealer-button" *ngIf="player.is_button">D</span>
            <span class="blind-indicator sb" *ngIf="player.is_small_blind">SB</span>
            <span class="blind-indicator bb" *ngIf="player.is_big_blind">BB</span>
          </div>
        </div>

        <!-- Informa√ß√µes do Jogador -->
        <div class="player-info">
          <div class="player-name" [class.hero-name]="player.is_hero">
            {{ player.name }}
            <span class="hero-indicator" *ngIf="player.is_hero">üë§</span>
          </div>
          <div class="player-stack">{{ formatStack(player.stack) }}</div>
        </div>

        <!-- Cartas do Jogador -->
        <div class="player-cards-container" *ngIf="shouldShowCards(player)">
          <div [ngClass]="getPlayerCardClass(player)">
            <span class="cards-text" [ngClass]="getCardClass(player.cards || '')">{{ formatCards(player.cards || '') }}</span>
          </div>
        </div>

        <!-- Fichas Visuais -->
        <div class="poker-chips chips-position-{{ player.position }}" *ngIf="shouldShowChips(player)">
          <div class="chip-stack">
            <div 
              *ngFor="let chipType of getPlayerChips(player); let i = index"
              class="chip-group"
            >
              <div 
                *ngFor="let chip of Array(chipType.count).fill(0); let j = index"
                class="chip {{ chipType.class }} chip-animate-in"
                [style.animation-delay.ms]="(i * chipType.count + j) * 100"
              ></div>
            </div>
          </div>
          <div class="bet-amount">
            {{ formatStack(player.current_bet) }}
          </div>
        </div>

        <!-- Status de A√ß√£o -->
        <div class="action-status" *ngIf="player.is_active">
          <div class="action-indicator"></div>
        </div>

      </div>

    </div>

    <!-- Controles Fullscreen -->
    <div class="fullscreen-controls-bottom">
      
      <!-- Informa√ß√µes da Street Atual -->
      <div class="street-info">
        <span class="street-name">{{ currentStreet.toUpperCase() }}</span>
        <span class="action-count">
          A√ß√£o {{ currentActionIndex + 1 }} de {{ getTotalActionsInStreet() }}
        </span>
      </div>

      <!-- Bot√µes de Controle -->
      <div class="control-buttons">
        <button 
          class="control-btn" 
          (click)="previousAction()"
          [disabled]="!canGoPrevious()"
          title="A√ß√£o Anterior"
        >
          ‚èÆÔ∏è Anterior
        </button>
        
        <button 
          class="control-btn" 
          (click)="nextAction()"
          [disabled]="!canGoNext()"
          title="Pr√≥xima A√ß√£o"
        >
          ‚ñ∂Ô∏è Pr√≥xima
        </button>
        
        <button 
          class="control-btn" 
          (click)="previousStreet()"
          [disabled]="currentStreetIndex <= 0"
          title="Street Anterior"
        >
          ‚è™ Street Anterior
        </button>
        
        <button 
          class="control-btn" 
          (click)="nextStreet()"
          [disabled]="!canGoNextStreet()"
          title="Pr√≥xima Street"
        >
          ‚è≠Ô∏è Pr√≥xima Street
        </button>
        
        <button 
          class="control-btn restart" 
          (click)="restartHand()"
          title="Reiniciar M√£o"
        >
          üîÑ Reiniciar
        </button>
      </div>

    </div>

  </div>
</div>

