<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo-section">
        <img src="assets/images/logo_main.png" alt="GapHunter" class="logo">
        <h1>GapHunter</h1>
      </div>
      
      <div class="user-section">
        <span class="welcome-text">Bem-vindo, {{ currentUser?.nickname || currentUser?.full_name }}!</span>
        <button class="logout-button" (click)="logout()">Sair</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Upload Section -->
    <div class="upload-section">
      <h2>📁 Upload de Hand History</h2>
      
      <div 
        class="upload-area"
        [class.drag-over]="isDragOver"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)">
        
        <div class="upload-content">
          <div class="upload-icon">📁</div>
          <h3>Arraste um arquivo ou clique para selecionar</h3>
          <p>Formatos suportados: .txt</p>
          
          <input 
            type="file" 
            id="file-input"
            accept=".txt"
            (change)="onFileSelected($event)"
            style="display: none;">
          
          <button 
            class="select-file-button"
            (click)="openFileDialog()"
            [disabled]="isUploading">
            Selecionar Arquivo
          </button>
        </div>
      </div>

      <!-- Selected File Info -->
      <div *ngIf="selectedFile" class="selected-file">
        <div class="file-info">
          <span class="file-name">{{ selectedFile.name }}</span>
          <span class="file-size">({{ (selectedFile.size / 1024).toFixed(1) }} KB)</span>
        </div>
        
        <button 
          class="upload-button"
          (click)="uploadFile()"
          [disabled]="isUploading">
          <span *ngIf="!isUploading">Analisar Mãos</span>
          <span *ngIf="isUploading" class="loading">Analisando...</span>
        </button>
      </div>

      <!-- Upload Message -->
      <div *ngIf="uploadMessage" 
           class="upload-message"
           [class.success]="uploadMessage.includes('Sucesso')"
           [class.error]="!uploadMessage.includes('Sucesso')">
        {{ uploadMessage }}
      </div>
    </div>

    <!-- Navigation Button -->
    <div class="navigation-section">
      <button class="history-button" (click)="goToHistory()">
        📊 Ver Histórico Completo
      </button>
    </div>

    <!-- Performance Overview -->
    <div class="performance-overview">
      <h2>🎯 Visão Geral de Performance</h2>
      
      <div class="overview-grid">
        <div class="overview-card">
          <div class="card-icon">🃏</div>
          <div class="card-content">
            <h3>{{ totalHands }}</h3>
            <p>Total de Mãos</p>
          </div>
        </div>
        
        <div class="overview-card">
          <div class="card-icon">⚠️</div>
          <div class="card-content">
            <h3>{{ gapsFound }}</h3>
            <p>Gaps Identificados</p>
          </div>
        </div>
        
        <div class="overview-card">
          <div class="card-icon">📈</div>
          <div class="card-content">
            <h3>{{ (100 - gapPercentage).toFixed(1) }}%</h3>
            <p>Taxa de Acerto</p>
          </div>
        </div>
        
        <div class="overview-card">
          <div class="card-icon">💰</div>
          <div class="card-content">
            <h3>{{ averagePot | currency:'USD' }}</h3>
            <p>Pot Médio</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Key Performance Indicators -->
    <div class="kpi-section">
      <h2>📊 Indicadores de Performance</h2>
      
      <div class="kpi-grid">
        <!-- Position Performance -->
        <div class="kpi-card">
          <h3>🎯 Performance por Posição</h3>
          <div class="kpi-chart">
            <div *ngFor="let stat of positionStats" class="kpi-bar">
              <div class="kpi-info">
                <span class="kpi-label">{{ getPositionName(stat.position) }}</span>
                <span class="kpi-value">{{ stat.count }} mãos</span>
                <span class="kpi-percentage">({{ getPercentage(stat.count, totalHands) }}%)</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getPercentage(stat.count, totalHands)"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Distribution -->
        <div class="kpi-card">
          <h3>⚡ Distribuição de Ações</h3>
          <div class="kpi-chart">
            <div *ngFor="let stat of actionStats" class="kpi-bar">
              <div class="kpi-info">
                <span class="kpi-label">{{ getActionName(stat.action) }}</span>
                <span class="kpi-value">{{ stat.count }} vezes</span>
                <span class="kpi-percentage">({{ getPercentage(stat.count, totalActions) }}%)</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" 
                     [style.width.%]="getPercentage(stat.count, totalActions)"
                     [class]="'action-' + stat.action"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Gap Analysis -->
    <div class="gap-analysis">
      <h2>🔍 Análise de Gaps</h2>
      
      <div class="gap-grid">
        <div class="gap-card">
          <h3>⚠️ Gaps por Street</h3>
          <div class="gap-chart">
            <div *ngFor="let gap of streetGaps" class="gap-item">
              <span class="gap-street">{{ gap.street }}</span>
              <span class="gap-count">{{ gap.count }}</span>
              <span class="gap-percentage">({{ gap.percentage }}%)</span>
            </div>
          </div>
        </div>

        <div class="gap-card">
          <h3>🎯 Gaps por Posição</h3>
          <div class="gap-chart">
            <div *ngFor="let gap of positionGaps" class="gap-item">
              <span class="gap-position">{{ getPositionName(gap.position) }}</span>
              <span class="gap-count">{{ gap.count }}</span>
              <span class="gap-percentage">({{ gap.percentage }}%)</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Improvement Areas -->
    <div class="improvement-areas">
      <h2>📈 Áreas de Melhoria</h2>
      
      <div class="improvement-grid">
        <div class="improvement-card">
          <div class="improvement-icon">🎯</div>
          <h3>Posições Premium</h3>
          <p>Foque em melhorar sua performance nas posições late (BTN, CO, HJ)</p>
          <div class="improvement-stats">
            <span class="stat">Taxa de Agressão: {{ premiumPositionAggression }}%</span>
          </div>
        </div>

        <div class="improvement-card">
          <div class="improvement-icon">💰</div>
          <h3>Bet Sizing</h3>
          <p>Analise se seus tamanhos de aposta estão otimizados</p>
          <div class="improvement-stats">
            <span class="stat">Pot Médio: {{ averagePot | currency:'USD' }}</span>
          </div>
        </div>

        <div class="improvement-card">
          <div class="improvement-icon">🔄</div>
          <h3>Continuation Bet</h3>
          <p>Verifique sua taxa de C-Bet no flop</p>
          <div class="improvement-stats">
            <span class="stat">Taxa C-Bet: {{ cbetRate }}%</span>
          </div>
        </div>

        <div class="improvement-card">
          <div class="improvement-icon">⚡</div>
          <h3>3-Bet Strategy</h3>
          <p>Analise sua frequência de 3-bet</p>
          <div class="improvement-stats">
            <span class="stat">Taxa 3-Bet: {{ threeBetRate }}%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Monthly Progress -->
    <div class="monthly-progress">
      <h2>📅 Progresso Mensal</h2>
      
      <div class="progress-chart">
        <div class="chart-container">
          <canvas #progressChart></canvas>
        </div>
        <div class="progress-stats">
          <div class="progress-stat">
            <span class="stat-label">Mãos este mês:</span>
            <span class="stat-value">{{ handsThisMonth }}</span>
          </div>
          <div class="progress-stat">
            <span class="stat-label">Gaps este mês:</span>
            <span class="stat-value">{{ gapsThisMonth }}</span>
          </div>
          <div class="progress-stat">
            <span class="stat-label">Melhoria:</span>
            <span class="stat-value" [class.positive]="monthlyImprovement > 0" [class.negative]="monthlyImprovement < 0">
              {{ monthlyImprovement > 0 ? '+' : '' }}{{ monthlyImprovement }}%
            </span>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

  <!-- Componente de Progresso de Upload -->
  <app-upload-progress #progressComponent *ngIf="isUploadingInProgress"></app-upload-progress>
